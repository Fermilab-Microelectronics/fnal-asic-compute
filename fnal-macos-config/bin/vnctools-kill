#!/usr/bin/env bash

(
    set -euo pipefail
    source `which vnctools-opts` $@
    display=${display:?"Error. display not defined."}
    hostname=${hostname:?"Error. hostname not defined."}
    username=${username:?"Error. username not defined."}

    set -x
    kinit -ft ~/.kerberos/${username}.keytab ${username}@FNAL.GOV && klist
    ssh ${username}@${hostname}.fnal.gov "set -x; vncserver -kill :${display}; \rm -f /tmp/.X${display}-lock; \rm -f /tmp/.X11-unix/X${display}; vncserver -list"
)
